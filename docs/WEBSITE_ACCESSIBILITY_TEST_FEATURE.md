# 网站可访问性对比测试功能

## 功能概述

网站可访问性对比测试功能是专为网络维护人员设计的诊断工具，用于验证用户报告的网站访问问题。该功能通过对比不同运营商网络环境下的网站访问情况，帮助快速判断网站访问问题是否由运营商封堵引起。

## 业务场景

### 典型使用场景
1. **用户投诉网站无法访问** - 维护人员需要验证问题真实性
2. **运营商封堵检测** - 判断是否由特定运营商封堵导致
3. **网络质量对比** - 比较不同运营商的网站访问性能
4. **故障诊断** - 排查网络连接问题的根本原因

### 解决的痛点
- ❌ **手动验证耗时** - 维护人员需要手动切换不同网络测试
- ❌ **缺乏对比数据** - 无法同时获取多个运营商的访问情况
- ❌ **判断不准确** - 仅凭HTTP状态码难以准确判断访问性
- ❌ **缺乏证据** - 缺少客观数据支撑故障判断

## 功能特性

### 🌐 多运营商对比测试
- **本地网络** - 当前树莓派连接的网络环境
- **中国电信** - 使用电信DNS (114.114.114.114)
- **中国联通** - 使用联通DNS (123.125.81.6)
- **中国移动** - 使用移动DNS (223.5.5.5)
- **公共DNS** - 使用Google DNS (8.8.8.8)

### 📊 全面的检测指标
- **HTTP状态码** - 服务器响应状态
- **响应时间** - 网站加载速度
- **内容大小** - 实际返回的数据量
- **IP地址** - 解析到的服务器IP
- **重定向检测** - 是否发生URL重定向
- **内容验证** - 检查返回内容是否为正常网页

### 🎯 智能判断机制
- **不仅仅是HTTP 200** - 深度分析返回内容
- **错误页面识别** - 检测伪装的错误页面
- **重定向处理** - 智能处理301/302跳转
- **超时检测** - 自动处理网络超时情况

## 技术实现

### 后端架构
```
backend/app/api/network.py
├── website_accessibility_test()     # 主要测试函数
├── test_website_with_carrier()      # 单个运营商测试
└── website_screenshot()             # 截图功能 (预留)
```

### 前端组件
```
frontend/components/ai-diagnosis/
├── WebsiteAccessibilityResult.tsx   # 结果展示组件
├── DiagnosisToolbar.tsx             # 工具栏集成
└── StepwiseDiagnosisInterface.tsx   # 智能诊断集成
```

### API端点
- **后端**: `POST /api/network/website-accessibility-test`
- **前端**: `POST /api/website-accessibility-test`

## 使用方法

### 1. 在AI诊断页面使用
1. 访问 `/ai-diagnosis` 页面
2. 在右侧工具栏找到"网站可访问性对比测试"
3. 输入要测试的网站URL (如: baidu.com)
4. 点击"测试"按钮
5. 等待测试完成，查看详细结果

### 2. 在智能诊断页面使用
1. 访问 `/smart-diagnosis` 页面
2. 点击快速诊断按钮中的"网站可访问性测试"
3. 在弹出对话框中输入网站URL
4. 系统自动执行测试并显示结果

### 3. 通过AI对话触发
- 发送消息："测试baidu.com的可访问性"
- AI会自动调用工具执行测试

## 测试结果解读

### 🟢 全部运营商可访问
- **结论**: 网站正常，非运营商封堵问题
- **建议**: 检查用户本地网络配置

### 🟡 部分运营商不可访问
- **结论**: 可能存在运营商封堵
- **建议**: 联系相关运营商确认封堵策略

### 🔴 全部运营商不可访问
- **结论**: 网站本身存在问题
- **建议**: 检查网站服务器状态

### 📊 性能对比分析
- **响应时间差异** - 识别最优运营商
- **IP地址差异** - 检测CDN分布情况
- **内容大小差异** - 发现内容劫持问题

## 示例测试结果

```json
{
  "url": "https://baidu.com",
  "test_time": "2025-07-12T15:26:44.761106",
  "results": [
    {
      "carrier": "本地网络",
      "accessible": true,
      "status_code": 200,
      "response_time": 494.93,
      "ip_address": "182.61.201.211"
    },
    {
      "carrier": "中国电信", 
      "accessible": true,
      "status_code": 200,
      "response_time": 420.86,
      "ip_address": "182.61.201.211"
    }
    // ... 其他运营商结果
  ]
}
```

## 扩展功能 (计划中)

### 🖼️ 网站截图功能
- 自动截取网站页面截图
- 可视化对比不同运营商访问结果
- 检测页面内容是否被篡改

### 📈 历史数据分析
- 记录测试历史数据
- 生成可访问性趋势报告
- 运营商封堵变化监控

### 🔔 自动化监控
- 定时自动测试重要网站
- 异常情况实时告警
- 批量网站监控

## 部署说明

### 依赖要求
- **后端**: aiohttp >= 3.8.0
- **前端**: React 组件已集成

### 配置文件
无需特殊配置，使用默认DNS服务器设置。

### 兼容性
- ✅ 树莓派5 (主要部署环境)
- ✅ macOS (开发调试环境) 
- ✅ Linux (通用支持)

## 故障排查

### 常见问题
1. **DNS解析失败** - 检查网络连接和DNS配置
2. **请求超时** - 调整超时时间设置
3. **证书错误** - 验证HTTPS证书有效性

### 调试方法
- 查看浏览器控制台日志
- 检查后端服务日志
- 使用curl直接测试API端点

## 更新日志

### v1.0.0 (2025-07-12)
- ✅ 基础网站可访问性测试功能
- ✅ 多运营商DNS对比测试
- ✅ 详细结果展示界面
- ✅ 集成到AI诊断工具栏
- ✅ 智能诊断快速按钮支持

---

*此功能是"大AI哥装维智能体"系列工具的核心组成部分，专为提升网络维护效率而设计。* 